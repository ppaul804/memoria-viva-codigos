<meta charset="UTF-8" />
<link rel="stylesheet" href="../bootstrap-combined.min.css">
<script src="../bootstrap.min.js"></script>
<script src="http://www.tst.jus.br/tst-internet-lf6_2-ee-theme/js/jquery-1.7.1-min.js" type="text/javascript"></script>
<style type="text/css">
	body {
		font-family: "Arial", "Verdana", sans-serif;
	}
</style>
<!-- -------------------------------------------------------------------------- -->

<style type="text/css">
	.container-fluid {}

	.box {
		width: 99%;
		/* centraliza a box */
		margin: 0 auto;
	}

	.accordion {
		background-color: #044f86;
		color: white;
		cursor: pointer;
		padding: 5px;
		border: none;
		border-radius: 5px;
		margin-bottom: 10px;
		width: 100%;
		text-align: center;
		outline: none;
		font-size: 15px;
		transition-duration: 0.4s;
	}

	.active,
	.accordion:hover {
		background-color: #ccc;
		color: black
	}

	.panel {
		padding: 0 18px;
		background-color: white;
		max-height: 0;
		overflow: hidden;
		transition: max-height 0.2s ease-out;
	}
</style>

<h2>Accordion</h2>

<p>Os Accordions são úteis quando você quer alternar entre ocultar e mostrar grande quantidade de conteúdo:</p>

<div class="container-fluid">
	<div class="box">
		<button class="accordion">Seção 1</button>
		<div class="panel">
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
				magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
				consequat.</p>

			<div class="box">
				<button class="accordion">Seção 1.1</button>
				<div class="panel">
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
						magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
						consequat.</p>
				</div>
			</div>
			<div class="box">
				<button class="accordion">Seção 1.2</button>
				<div class="panel">
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
						magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
						consequat.</p>
					<div class="box">
						<button class="accordion">Seção 1.2.1</button>
						<div class="panel">
							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
								dolore
								magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
								consequat.</p>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="box">
		<button class="accordion">Seção 2</button>
		<div class="panel">
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
				magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
				consequat.</p>
		</div>
	</div>

	<div class="box">
		<button class="accordion">Seção 3</button>
		<div class="panel">
			<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
				magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
				consequat.</p>
		</div>
	</div>
</div><!-- container-fluid -->

<script>
	var acc = document.getElementsByClassName("accordion");
	var box = document.getElementsByClassName("box");
	var pan = Array.prototype.slice.call(document.getElementsByClassName("panel"));
	// vetor de atualização da altura dos panels
	var panelsHeight = [];

	pan.forEach(panel => {
		if (panel.style.maxHeight == "")
			console.log(panel);
		else
			console.log(panel);
	});
	console.log("---------------------------------------------");


	for (var i = 0; i < acc.length; i++) {
		acc[i].addEventListener("click", function (e) {
			var thisBox = e.target.parentElement;
			var sectionBoxes = thisBox.parentElement.children;
			// cria Array do HTMLCollection
			var rawSecBoxs = Array.prototype.slice.call(sectionBoxes);
			var secBoxs = []; // é os boxs da seção
			rawSecBoxs.forEach(rawSecBox => {
				// filtra por class="box"
				if (rawSecBox.classList.contains("box")) {
					secBoxs.push(rawSecBox);
				}
			});

			this.classList.toggle("active");
			// console.log("this element");
			// console.log(this);

			// defini o panel do accordion clicado
			var panel = this.nextElementSibling;
			var panelIndex = pan.indexOf(panel);

			// se tem tamanho definido, ou seja, estiver aberto
			if (panel.style.maxHeight) {
				console.log('FECHA');
				// console.log("panel");
				// console.log(panel);

				panelsHeight.pop(panel);
				console.log(panelsHeight);

				// fecha o panel
				panel.style.maxHeight = null;

				pan.forEach(panel => {
					if (panel.style.maxHeight == "")
						console.log(panel);
					else
						console.log(panel);
				});
			} else {
				// console.log('ABRE');

				// abre o panel
				panel.style.maxHeight = panel.scrollHeight + "px";

				// atualiza o tamanho do panel anterior
				console.log(panelIndex);
				console.log(pan.length);
				console.log("---");
				for (var j = panelIndex; j > -1; j--) {
					console.log(pan[j]);
				}
				var panelAnterior = panel.parentElement.parentElement;
				// console.log("panelAnterior");
				// console.log(panelAnterior);

				panelAnterior.style.maxHeight = (panelAnterior.scrollHeight + panel.scrollHeight) + "px";
				console.log("maxHeight do elem anterior " + panelAnterior.style.maxHeight);

				// fecha os outros panels dos boxes da seção
				secBoxs.forEach(secBox => {
					// pega o panel do box
					var secPanel = secBox.lastElementChild;
					// se o panel da seção não for igual o panel do acc originalmente clicado
					if (panel !== secPanel) {
						// considera o elemento anterior como o accordion da seção
						secAcc = secPanel.previousElementSibling;
						// se o acc não clicado tiver class = "active"
						if (secAcc.classList.contains("active")) {
							// desativa ele
							secAcc.classList.toggle("active");
						}
						// finalmente fecha o panel da seção
						secPanel.style.maxHeight = null;
					}
				});

				pan.forEach(panel => {
					if (panel.style.maxHeight == "")
						console.log(panel);
					else
						console.log(panel);
				});

			}
			console.log("---------------------------------------------");
		});
	}
</script>